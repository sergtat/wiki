#  Как разобрать и собрать tomato
1) Нам понадобится linux.

Я пошел по пути наименьшего сопротивления, поставил virtualbox, в него Ubuntu 10.10 (весной заканчивается поддержка, есть наверно смысл поставить 10.04 LTS)- одна из самых "дружелюбных" систем для незнакомых с linux, 11 версия мне что то не понравилась, не было времени ковырятся. Так же есть дружелюбная linux mint - интерфейс "виндоусообразный".

2) В домашней папке пользователя (у меня это /home/vlad/ - у вас своя) создаем папку mod-kit,

![](/images/Linux/Router/tomato-01.png '')

внутри нее еще 4 папки:

- `firmware` - в нее сложим прошивки которые будем разбирать
- `firmware_new` - в ней будут наши готовые модифицированные прошивки
- `target` - в ней будет распакованная структура прошивки
- `trunk` - в ней будет пакет программ, который будет собирать и разбирать прошивки

![](/images/Linux/Router/tomato-02.png '')

3) Далее нам нужно скачать пакет [Firmware Modification Kit](http:_www.bitsum.com/files/firmware_mod_tools.tar.gz) или [зеркало](http:_tomatousb.ru/opt/firmware_mod_tools.tar.gz) и распаковать архив в папку /home/vlad/mod-kit/trunk

![](/images/Linux/Router/tomato-03.png '')

4) Для корректной работы в системе должны быть установлены C++ пакеты

![](/images/Linux/Router/tomato-04.png '')

Если во время работы будут ошибки - в папке с программой появится лог работы, в котором будет написано, в каком файле, в какой строке ошибка, посмотрев эту строку можно догадаться каких еще пакетов не хватает в системе.

5) Ну теперь все готово ) закидываем прошивку, которую хотим вскрыть в каталог firmware, назовем ее к примеру tomato3g.trx

6) переходим в папку /home/vlad/mod-kit/trunk и даем команду

`./extract_firmware.sh ../firmware/tomato3g.trx ../target`

распакует содержимое прошивки tomato3g.trx в папку /target (корневой каталог прошивки root)

![](/images/Linux/Router/tomato-05.png '')

7) Дальше можете посмотреть, что то изменить, добавить в прошивку (веб-интерфейс лежит в папке www)

![](/images/Linux/Router/tomato-06.png '')

8) После того как все сделали (а в dual wan сгенерировали контрольную сумму в папке www запуском signit.sh) собираем прошивку, для этого снова переходим в папку /home/vlad/mod-kit/trunk и даем команду

`./build_firmware.sh ../firmware_new ../target`

это соберебет заготовку из папки target в файл прошивки в папку firware_new

![](/images/Linux/Router/tomato-07.png '')

9) В нашем случае нужен только файл custom_image_asus.trx - это и есть наша модифицированная прошивка (файлы отличаются начальным кодом, поэтому прошивки от linksys wrt54*.bin не совместимы с asus)

Ну вот и все, дерзайте!

