#  Создаем DVD диск
##  Составим план и подготовим AVI

Формат AVI-файлов - обычный, как для сброса на DV-камеру, в т.ч. важно "Field_A"(по версии Ulead 6.x).

На DVD влезает от часа до двух в зависимости от битрейта. Формат DVD позволяет создавать разветвлённые системы меню и оперативно переключаться между разными видеоматериалами. Лучше всего предварительно посмотреть несколько "настоящих" DVD чтобы представлять какие материалы могут размещаться на диске. Если Ваши фильмы короткие, можно разместить их на одном диске с переключением через главное меню. Можно также размещать т.н. "бонусы"("дополнения") - вырезанные сцены, интервью с участниками, фотоальбомы и прочее.

Очень легко делаются диски с двумя (и более) аудиодорожками. Изначально это предполагалось для разных языков, но в любительской съёмке этому есть другие интересные применения:

- на первой дорожке - "режиссёрский" звук, т.е. с музыкой, спецэфектами, часто без реального звука с камеры; а на второй дорожке - чисто оригинальный звук, без музыки.
- на первой дорожке - "цензурный" вариант, на второй - полный.
- на второй дорожке - комментарий режиссёра или других участников событий к происходящему.

Для этого на этапе монтажа разделяем варианты по звуковым трекам в видеоредакторе и при рендеринге просто отключаем ненужные.

Если мы хотим чтобы фильм мог просматриваться ЦЕЛИКОМ без вмешательства с пульта или небольших пауз между частями, это должен быть ОДИН длинный мпег-файл. Его из нескольких avi можно изготовить двумя способами - либо склеить их в один DV-avi ещё на этапе монтажа, либо закодировать в mpeg2 отдельно, а затем склеить в один длинный MPEG. Первое надёжнее и идеологически проще, но требует чуть больше места на винчестере. Тем не менее я советую именно первый способ (avi сразу нужной длины).

К сожалению, трудно заранее сказать сколько минут КОНКРЕТНЫХ материалов влезет на болванку с достойным качеством, а без этого трудно планировать размер бонусов или количество частей. Единственный способ - пробное кодирование типичных фрагментов с разными битрейтами, простейший авторинг и тест на телевизоре. Но об этом подробно будет рассказано далее...

##  Готовим MPEG2.
Сначала немного поговорим о параметрах кодирования, независимо от того, какую программу использовать.

###  Выбор битрейта.
Доступный диапазон среднего значения битрейта от 2000 до 9000 кбит/сек (другие значения не рекомендуются из-за возможной несовместимости). Чем выше значение, тем выше качество (меньше искажений и артефактов), но меньше минут влезет на болванку. Для тех, кто не в ладах с арифметикой, привожу ПРИМЕРНУЮ таблицу соответствия (предполагается, что звук DD2.0-192кбит/сек; под длительностью понимается суммарная длительность всех материалов на одной болванке, в.т.ч. на меню имеет смысл оставить как минимум от 2 до 4 минут в зависимости от количества "эпизодов" фильма):
|**Длительность фильма(минуты)**|**Средний битрейт ("Avg")**|
|65 и менее 	|9000|
|70 	|8500|
|80 	|7400|
|90 	|6600|
|100 	|5900|
|110 	|5300|
|120 	|4900|
|130 	|4500|
|140 	|4200|
Если звук предполагается DD5.1 (448kbps), из табличного значения Avg нужно вычесть 448. Если же предполагается более одной звуковой дорожки (например на разных языках либо "оригинальный" звук без музыки и эффектов), нужно вычесть 192 для второй и последующих дорожек (DD2.0, т.е. стерео). Очень важно понимать, что качество конечного фильма зависит не только от битрейта, но и от исходного материала, поэтому нельзя сказать однозначно заранее какой битрейт обеспечит какое качество. Иногда фильм с 8000 имеет больше искажений чем _другой_ фильм с 4000. Надёжнее всего экспериментальная проверка на телевизоре. Возможны разные ситуации, к примеру:
- Есть уже готовый ОДИН фильм короче 65минут и хочется его оформить отдельным DVD-диском. Тогда разумно сжать его с максимальным битрейтом (9000), а оставшееся место на диске занять, чтобы не пропадало, длинными качественными меню (с предпросмотром отдельных эпизодов и музыкальным сопровождением), а также бонусами (фотоальбом, дополнительные материалы, вырезанные сцены, биография режиссёра - что угодно...).
- Есть уже готовый ОДИН фильм от 65 до 140 минут. Жмём относительно небольшой (минут десять) типичный фрагмент с битрейтом из таблицы и записываем простейшим авторингом (без меню и прочих наворотов) на DVD-RW. Смотрим на телевизоре. Если качество устраивает - жмём весь фильм с этим битрейтом. Если нет - разбиваем его на серии и пишем на две болванки (т.е. для каждой серии процедура выбора начинается сначала).
- Есть уже готовый длинный фильм (более 140минут). Сразу разбиваем на серии и начинаем сначала...
- Есть набор материала который можно произвольно расписать на болванки, например массив коротких домашних съёмок или небольших клипов. На каком именно клипе закончить один DVD и начать другой - непринципиально. Если материал "лёгкий" для кодера (те же домашние съёмки, при достаточном освещении), совершенно бессмысленно тратить лишние деньги на болванки с битрейтом 9000. Поэтому опять берётся пробный типичный кусок и кодируется с разными битрейтами (например 4000-5000-6000-7000). Записывается на болванку простейшим авторингом (без меню и пр.) И на телевизоре выясняется, начиная с какого битрейта начинает ухудшаться качество. К примеру, если 5000-7000 выглядят примерно одинаково, а 4000 хуже, значит кодировать надо на 5000. Просчитываем сколько минут влезет на болванку и в видеоредакторе "склеиваем" нужное число материалов в фильм этой длины.

  (vb + ab) х t / 8 = Size
  где:
  vb - битрет видео в кбит/сек
  ab - битрет звука в кбит/сек
  t - время в секундах
  Size - объем полученного материала в килибайтах
  Деление на восемь служит для перевода килобит в килобайты.
  Перевод килобайт в мегабайты осуществляется делением на 1024. В гигабайты так же.
  Это справедливо для постоянного битрейта. Для переменного будет неточно.
  Кстати, переменный битрейт при однопроходном кодировании или кодировании на лету малоэфективен и лучше использовать постоянный в этих случаях.

###  Метод кодирования
Большинство кодеров поддерживают три режима кодирования - CBR, VBR1 ("1-pass"), VBR2 ("2-pass"). При средних и низких значениях среднего битрейта (4000-7500) VBR при одном и том же размере файла даст обычно более высокое субъективное качество, чем CBR, т.к. он кодирует простые куски с битрейтом ниже среднего, а высвобождающийся "излишек" отдаёт сложным динамичным сценам. CBR жмёт всё с одинаковым битрейтом, в результате простые сцены получаются "излишне" качественными(глазом разницу незаметно), но сложные - недостаточно качественными (глаз видит артефакты). Отличия VBR1 и VBR2, как показывают письма и конференции, не до конца многим понятны, поэтому остановлюсь на них подробнее.
|**Параметр**|**VBR1**|**VBR2**|
|Время кодирования|Примерно вдвое быстрее VBR2. ЕДИНСТВЕННОЕ ДОСТОИНСТВО.|Примерно вдвое медленнее VBR1. ЕДИНСТВЕННЫЙ НЕДОСТАТОК.|
|Размер файла|непредсказуем (получается лишь ориентировочно равным заказанному)|точно равен заказанному (лишь с небольшими отклонениями в зависимости от кодера)|
|Качество на "однородных" фильмах (все эпизоды одинаково сложны/просты для кодирования). Типичный пример - съёмка свадебной церемонии, младенца в кроватке (весь фильм!!), лекции(семинара).|Совпадает с VBR2|Cовпадает с VBR1|
|Качество на "разнородных" фильмах (большинство реальных фильмов). Имеются как "простые" эпизоды (статика, портреты, диалоги), так и "сложные" (динамика, вода, прибой, колышащаяся от ветра трава/листва и пр.).|Заметно ниже, чем VBR2 при "средних"(5000-7000) значениях среднего битрейта. На "сложных" фрагментах кодер "боится" ставить битрейт 9200 ("а вдруг сложный будет и дальше - ведь не уложимся!") а на "очень простых" фрагментах кодер "боится" понижать битрейт до 1000-2000 по той же причине ("вдруг и дальше будет так же, тогда в качестве недоберём"). В результате колебания битрейта вокруг среднего получаются не слишком большими. Результат уже значительно лучше, чем при CBR, но всё же все возможности VBR до конца не используются.|Заметно выше, чем VBR1 при "средних"(5000-7000) значениях среднего битрейта. После первого прохода кодер уже имеет ПОЛНУЮ информацию о продолжительности как сложных, так и простых фрагментов и "смело" ставит как экстремально низкие, так и экстремально высокие значения битрейтов в соответствующих местах.|

Что из этого следует на практике?

- Для наилучшего качества применяется VBR2. Это - основной метод. Другие применяются лишь в нескольких оговоренных ниже случаях...
- CBR разумно применять при среднем битрейте 8500-9000 (т.к. на динамичных сценах VBR-у прибавить уже нечего - и так битрейт максимальный)
- Иногда CBR приходится применять на фотоальбомах, где длинные неподвижные кадры сменяются резкими переходами. При этом у некоторых кодеров в режиме VBR после перехода может "плыть" качество неподвижной картинки, что неприятно для глаза.
- VBR1 имеет смысл применять при _остром_ недостатке времени (нужно демонстрировать или дарить диск СРОЧНО) и наличии "регулирующих" дополнений. Например, если есть бонус и основной фильм получился вдруг больше намеченного, можно пожать бонус менее качественно чтобы всё вместе влезло на болванку, а основной фильм больше не трогать.
- VBR1 также оправдан при среднем битрейте 8000-8500 и/или при достаточно однородных фильмах (и опять-таки при цейтноте).

Возможно вам пригодится информация по обозначению DVD дисков (болванок для записи):
  DVD5 - односторонний однослойный (4.7 Гб)
  DVD9 - односторонний двухслойный (8.5 Гб)
  DVD10 - двусторонний однослойный
  DVD14 - двусторонний, однослойный с одной стороны и двухслойный с другой
  DVD18 - двусторонний двухслойный

###  Стандартная структура диска DVD.
Если взять любой стандартный DVD, то, открыв его, вы обнаружите две папки - AUDIO_TS и VIDEO_TS. Откроем вторую папку VIDEO_TS. Внутри вы находятся различные файлы с расширениями BUP, IFO и VOB.
  IFO - это информационные файлы диска, они "знают", что находится в файлах VOB и поддерживают порядок их запуска.
  BUP - файл резервного копирования файла IFO (для подстраховки). Обратите внимание, каждому файлу IFO соответствует файл BUP такого же размера.
  VOB - основные файлы DVD, в которых содержится информация о видео, аудио, титрах.

###  Ссылки
http://addon.video-sam.ru/  
http://dvdauthor.sourceforge.net/doc/index.html  
http://www.tux.in.ua/articles/703  
http://www.dalberta.com/dvdcreate.shtml  
http://help.ubuntu.ru/wiki/multimedia  
http://forum.videohelp.com/threads/298871-More-than-12-buttons-with-dvdauthor  
http://nfs.shawnfumo.com/wiki/DVDAuthor/XML  
http://rad.xtalk.msk.su/dv-dvd/index.html  