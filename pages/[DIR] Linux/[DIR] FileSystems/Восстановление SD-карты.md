# Восстановление SD-карты.
Симптомы: в любом кардридере под виндой карта (SD 4Gb SanDisk Ultra II) не видна (точнее, в системе после втыкания кардридера появляется на секунду диск, потом снова исчезает, а кардридер виснет), отформатировать невозможно, ни одна из прог для прямого доступа ничего сделать не может (кардридер уже висит).

Решение: под линуксом выполнить
```bash
dd bs=1M count=1 if=/dev/zero of=/dev/sdg
```
(`/dev/sdg` - usb-кардридер), после чего карту можно отформатировать. Предположительно, если бы выполнил
`dd bs=512 count=1 if=/dev/zero of=/dev/sda` - возможно, после танцев с бубном удалось бы сохранить и информацию с нее.

Да, использованный дистрибутив - Slax, грузился в консоль (при этом у него еще не грузится никаких приблуд для автомонтирования диска - это важно)

Возможные причины: кривой кардридер умудряется при записи портить сектора на карте так, что прочитать их нельзя (и при попытке чтения такого сектора ридер виснет), а записать можно (заодно исправив). Если такой сектор придется на MBR/bootsector - карта неработоспособна вообще, если на файл - кардридер будет виснуть при чтении этого файла (собственно, такой случай у меня произошел с другой картой, удалось восстановить "полновесным" форматированием - после чего и решил поэкспериментировать под линуксом, благо, он, пока карту не смонтируешь, ничего с нее не читает).

Надеюсь, кому-нибудь пригодится.

---------------------------
## Дополнительная инфа
1. Данные не нужны
    - Обнуление начальных секторов карты
        - Linux
            - Команда dd (или gdisk)
                
                Пример: dd bs=512 count=1 if=/dev/zero of=/dev/sda ("of=" - это обнуляемое устройство, поэтому надо внимательно проверить имя вашей карты, иначе можно обнулить ваш жесткий диск с ОС).
        - Windows
            - Программа HDDScan, выполнить запись (erase) по всему объему карты.
            - Программа DMDE, затереть первые 50-100 секторов карты.

    - Форматирование карты
        - Linux
            - Команда mkfs
        - Windows
            - Команда format
2. Данные нужны
    - O&O Disk Recovery, ищет файлы в 2 прохода, можно выбрать формат искомых файлов.
    - R-Studio, может делать образ карты.
    - Easy Recovery, сканирует файлы заметно лучше R-Studio, но склонна находить несуществующие файлы; часть найденной информации - дефектная.
    - Power Recovery Tool.
    - PhotoRescue.
    - TestDisk and PhotoRec, работает из консоли, на всякий случай запускайте с правами администратора, лучше разархивировать утилиту в раздел, где есть достаточно места.
    - ZAR, файлы с карт и USB-флеш восстанавливаются бесплатно, для работы с HDD нужно покупать полную версию.
    - DiskGetor Data Recovery.
    - File Scavenger.
    - После форматирования можно попробовать создать раздел и еще раз отформатировать в Acronis Disk Director.

## Методика проверки надежности карты.
В каком-то одном месте карты может находиться дефектная область, и она обычно не в начале диска. Кроме того, часто размер дефекта крайне небольшой – например, 4 МБ в карте на 32 ГБ.

Дефектность карты раскрывается в следующем. Запись не приводит к сообщениям об ошибках. Чтение не приводит к сообщениям об ошибках. Но при чтении возвращается совершенно не то, что было записано на карту.

Порядок действий

1. Отформатировать карту в файловую систему exFAT (если Windows XP, то надо вручную скачать обновление с кодом KB955704). В результате станут поддерживаться файлы размером больше 4 ГБ.
2. Создать на надёжном жёстком диске файл размером чуть меньше карты. Этот должен быть единственные файл, содержащий разнородную информацию (можно воспользоваться архиватором, объединив много файлов, без сжатия). Требуется именно единственный большой файл, т.к. много мелких файлов не охватят все секторы, и будут пропуски на карте, где может скрываться дефект.
3. Скопировать файл с жесткого диска на карту целиком.
4. Проверить оба файла на полное бинарное совпадение. Если хотя бы один байт не совпадает у этих файлов - карта проблемная.
Проверить бинарное совпадение в Windows можно командой "fc". 

Пример:
```
fc /b "C:\file" "D:\file" > "C:\out.log", где

"C:\file" - файл на жёстком диске;
"D:\file" - файл на карте;
"C:\out.log" - файл с результатами тестирования.
```
> Замечание. Для сохранения результатов сравнения размером 4 МБ утилита создала файл размером около 100 МБ.
