# Проверка порта
## Что за порты? Для чего они нужны?

Порты, которые проверяет PortScan.ru, — это не физические, а логические порты на компьютере или сетевом устройстве.
В случае, если программа или служба планирует работать с сетью, она открывает порт с уникальным номером, через который она может работать с удаленными клиентами/серверами. Фактически, сетевая программа резервирует для себя определенное число, которое позволяет понять, что пришедшие данные предназначаются именно этой программе.

На человеческом языке это звучало бы примерно так: "Я, программа-сервер, открываю порт номер 1234. Если по сетевому кабелю придут данные с номером порта 1234 — это мне. "

## Какие номера портов может открывать программа?

Порты идентифицируются номерами от 0 до 65535 включительно. Любой другой порт открыть нельзя, соответственно и проверить тоже. Это ограничения TCP/IP протокола.

Стоит отметить, что клиентская программа всегда должна знать номер порта, к которому ей нужно подключаться на сервере или другом удаленном сетевом устройстве. По этой причине для наиболее популярных протоколов зарезервированы порты в диапазоне от 0 до 1023.

Так, например, осуществляя серфинг в интернете, ваш браузер подключается к 80 порту на удаленном сервере, на котором находится сайт. В ответ браузер получает набор кода и данных, который скачивает и отображает в виде веб-страницы.

## Для каких ситуаций возможна проверка открытых портов?

Проверка открытых портов возможна, если вашему компьютеру присвоен внешний IP адрес. Подробнее об этом вы можете узнать у своего интернет-провайдера.

Стоит учесть, что если ваш компьютер подключен к интернету не напрямую, а через роутер (маршрутизатор), то результаты проверки относятся именно к роутеру. Проверить состояние порта для компьютера внутри такой подсети возможно только при наличии проброса портов.

## Что такое проброс портов?

Проброс портов (Port Forwarding, иногда Virtual Servers) — специальная настройка на роутере, позволяющая перенаправить внешние запросы (из интернета) на компьютеры локальной сети. По сути это способ указать, на какой локальный компьютер пересылать данные и запросы подключения, пришедшие на определенный порт.

Допустим, у вас дома игровой или веб-сервер, подключенный через роутер к интернету. Все компьютеры, подключенные к этому же роутеру, находятся в одной сети, поэтому смогут подключиться к данному серверу. Однако снаружи, из интернета, подключиться к вашему серверу без проброса портов уже не получится.

Если ваш компьютер подключен к интернету напрямую (без роутера/маршрутизатора), то выполнять проброс портов не требуется. Все ваши открытые порты должны быть доступны из интернета (естественно, при наличии выделенного IP).

## Как узнать, какие порты открыты на компьютере?

Для Windows: Пуск → "cmd" → Запустить от имени администратора → "netstat -bn"
Для Linux: В терминале выполнить команду: "ss -tln"

## Как закрыть порт?

Прежде всего надо устранить причину — запущенную программу или службу, которая открыла этот порт; ее надо закрыть/остановить. Если причина открытого порта не ясна — проверьте компьютер антивирусом, удалите лишние правила проброса портов на роутере и установите продвинутый файервол (Firewall). 

-------

## Проверяем доступность портов
Очень часто возникает потребность проверить порт на состояние открыт/закрыт. Но не многие смогут ответить на вопрос сколько есть способов для этого, и как проверить, например, открыт ли UDP порт. Ответы на эти вопросы постарась ответить в этой заметке.

### Проверка TCP-порта.

На данный момент мне удалось найти 3 метода, которыми это можно сделать:

#### с помощью telnet:
Если соединение удачно, то увидим такой ответ:
```bash
$telnet 11.1.1.11 25
Trying 11.11.11.11...
Connected to mail.domain.com.ua.
Escape character is '^]'.
220 mail.domain.com.ua ESMTP Postfix
```
Если же неудачное, то такое:
```bash
$telnet 11.11.11.11 23
Trying 11.11.11.11...
telnet: connect to address 11.11.11.11: Operation timed out
telnet: Unable to connect to remote host
```
Иногда в дополнении появляется такое:

    telnet: connect to address 11.11.11.11: Operation not permitted

#### с помощью nc (netcat)
Если соединение удачно, то увидим такой ответ:
```bash
$nc -v 11.11.11.11 25
Connection to 11.11.11.11 25 port [tcp/smtp] succeeded!
220 mail.domain.com.ua ESMTP Postfix
```
Если же неудачное, то такое:
```bash
$nc -v 11.11.11.11 23
nc: connect to 11.11.11.11 port 23 (tcp) failed: Operation timed out
```
#### с помощью nmap

Если соединение удачно, то увидим такой ответ:
```bash
#nmap  -p25 11.11.11.11

PORT   STATE SERVICE
25/tcp open  smtp
```
Если же неудачное, то такое:
```bash
#nmap  -p23 11.11.11.11

PORT   STATE  SERVICE
23/tcp closed telnet
```
Иногда при сканнировании выводится такое сообщение:
```bash
PORT   STATE    SERVICE
23/tcp filtered telnet
```
тогда сказать однозначно открыт или закрыт — нельзя.

### Проверка UDP-порта.
Здесь всего 2 способа.

#### с помощью nc (netcat)
Если соединение удачно, то увидим такой ответ:
```bash
$nc -uv 11.11.11.12 53
Connection to 11.11.11.12 53 port [udp/domain] succeeded!
```
Если же неудачное, то ничего не выводиться:
```bash
$nc -uv 11.1.1.12 50
$
```
#### с помощью nmap
Если соединение удачно, то увидим такой ответ:
```bash
#nmap -sU -p U:53 11.1.11.12
PORT   STATE         SERVICE
53/udp open|filtered domain
```
Если же неудачное, то такое:
```bassh
#nmap -sU -p U:53 11.1.11.13
PORT   STATE  SERVICE
53/udp closed domain
```
### Выводы
#### telnet
**Преимущества**: лёгко и удобно пользоваться, установлена практически на любой ОС, для запуска не требуются права root’a.
**Недостатки**: нельзя проверять UDP порты

#### nc (netcat)
**Преимущества**: лёгко и удобно пользоваться, установлена практически на любой ОС, для запуска не требуются права root’a, есть возможность сканирования UDP-портов
**Недостатки**: не обнаружено.

#### nmap
**Преимущества**: удобно пользоваться, функционал просто радует, есть возможность сканирования UDP-портов
**Недостатки**: для запуска требуются права root’a, устанавливать приходиться отдельно.
