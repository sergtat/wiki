# Удаленное управление теплом в гараже
![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_001.jpg 'Удаленное управление теплом в гараже')

Для обогрева своего гаража, я использую 2 "конвектора". Один конвектор включен постоянно на +5 градусов, для поддержания плюсовой температуры, второй "конвектор" включается по необходимости.

Раньше приходилось бегать, включать его, уходить домой, ждать час-два пока температура поднимется до комфортных +20, но это быстро надоело, одолела лень и я решил применить максимально бюджетный вариант удаленного включения на Arduino.

## Что необходимо было купить:

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_002.jpg 'Удаленное управление теплом в гараже')  
_Arduino nano 146 руб_

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_003.jpg 'Удаленное управление теплом в гараже')  
_Модуль ENC28J60 165 руб_

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_004.jpg 'Удаленное управление теплом в гараже')  
_Датчик температуры DHT22 151руб_

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_005.jpg 'Удаленное управление теплом в гараже')  
_Реле 40руб_

## Коротко о подключении всего этого барахла.

**Модуль ENC28J60:**

- VCC к 5V
- GND к GND
- SCK к Pin 13
- SO к Pin 12
- ST к Pin 11
- CS к Pin 10

**Реле:**

- S к Pin 2
- Vcc к 5V
- GND к GND

**Датчик температуры DHT22:**

- Vcc к 3.3V
- GND к GND
- DATA к Pin4

Здесь все понятно без схем, если не понятно, в интернете есть масса материала о том, как подключать эти модули. А вот готового скетча, я не нашел, да и искать было лень… Проще было найти скетч управления реле и скетч вывода данных с датчика, скрестить их и набросать страницу, чтоб ей было удобно управлять с телефона и обычного ПК.

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_006.jpg 'Удаленное управление теплом в гараже')

## Скетч получился вот такой:

```c
#include "DHT.h"
#include <EEPROM.h>
#define DHTPIN 4
#define DHTTYPE DHT22
DHT dht(DHTPIN, DHTTYPE);
#include <EtherCard.h>
static byte mymac[] = { 0x74,0x69,0x69,0x2D,0x30,0x31 }; // MAC Address должен быть уникальным в локальной сети
static byte myip[] = { 192,168,1,222 }; // Постоянный IP адресс нашей страницы
byte Ethernet::buffer[1000];
BufferFiller bfill;
// Начальные данные
int LedPins[] = {
2,3,5,6,7,8,9};
int t=0;
int h=0;
boolean PinStatus[7];
const char http_OK[] PROGMEM =
"HTTP/1.0 200 OK\r\n"
"Content-Type: text/html\r\n"
"Pragma: no-cache\r\n\r\n"
"\r\n"
"<meta charset='UTF-8'>"
"<meta name='viewport' content='width=device-width, initial-scale=1.0'>"
"<meta http-equiv='refresh' content='10'/>";
const char http_Found[] PROGMEM =
"HTTP/1.0 302 Found\r\n"
"Location: /\r\n\r\n";
const char http_Unauthorized[] PROGMEM =
"HTTP/1.0 401 Unauthorized\r\n"
"Content-Type: text/html\r\n\r\n"
"<h1>401 Unauthorized</h1>";
// Подключаем Ethernet порт HR911105A и датчик DHT22
void setup () {
if (ether.begin(sizeof Ethernet::buffer, mymac, 10) == 0)
Serial.println( "Failed to access Ethernet controller");
ether.staticSetup(myip);
for(int i = 0; i <= 7; i++)
{
pinMode(LedPins[i],OUTPUT);
PinStatus[i]=EEPROM.read(i);
digitalWrite(LedPins[i],PinStatus[i]);
}
dht.begin();
}
// Получаем данные от DHT22
static void ReadDHT22()
{
h = dht.readHumidity();
t = dht.readTemperature();
}
// Оформление Web страницы
static word homePage() {
bfill = ether.tcpOffset();
bfill.emit_p(PSTR("$F"
"<title>Гараж</title>"
"<p style=\"text-align: center;\"><br />Конвектор: <br> <span style=\"font-size: 4em;\"><a href=\"?ArduinoPIN2=$F\">$F</a></span>"),
http_OK,
PinStatus[0]?PSTR("off"):PSTR("on"),
PinStatus[0]?PSTR("<font color=\"green\"><b>ON</b></font>"):PSTR("<font color=\"red\">OFF</font>"));
bfill.emit_p(PSTR(
"<br><br>Температура: <br> <span style=\"font-size: 4em;\">$D C</span> <br /><br />Влажность:<br> <span style=\"font-size: 4em;\"> $D %</span></p>"),t, h);
return bfill.position();
}
void loop () {
delay(1); // Задержка
word len = ether.packetReceive();
word pos = ether.packetLoop(len);
if (pos) // check if valid tcp data is received
{
ReadDHT22();
bfill = ether.tcpOffset();
char *data = (char *) Ethernet::buffer + pos;
if (strncmp("GET /", data, 5) != 0) {
bfill.emit_p(http_Unauthorized);
}
else {
data += 5;
if (data[0] == ' ') {
homePage();
}
else if (strncmp("?ArduinoPIN2=on ", data, 16) == 0) {
PinStatus[0] = true;
digitalWrite(LedPins[0],PinStatus[0]);
EEPROM.write(0,PinStatus[0]); // записываем в ячейку EEPROM №0, текущее состояние LedPins[0].
bfill.emit_p(http_Found);
}
else if (strncmp("?ArduinoPIN2=off ", data, 17) == 0) {
PinStatus[0] = false;
digitalWrite(LedPins[0],PinStatus[0]);
EEPROM.write(0,PinStatus[0]);
bfill.emit_p(http_Found);
}
else {
// Page not found
bfill.emit_p(http_Unauthorized);
}
}
ether.httpServerReply(bfill.position()); // send http response
}
}
```

## Коротко о данном скетче:
В память ардуины (EEPROM) сохраняется информация о последнем положении кнопки реле, перебои со светом нам не страшны, положение кнопки всегда отражает реальное состояние реле, не будет такого, что на странице выводится OFF а на самом деле ON.

Далее подключаю сборку к локалке, для питания использую старую зарядку от мобильного телефона.

Вызываю страницу по IP адресу, который мы задали в начале скетча: http://192.168.1.222

**Получаю страницу с данными:**

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_007.jpg 'Удаленное управление теплом в гараже')

Всё открывается, данные с датчика верные, реле на нажатие кнопки реагирует, положение запоминает.

Далее нужен корпус. Можно заколхозить из какого-нибудь пластикового контейнера, или заказать на али типовой пластиковый корпус для подобного барахла, или купить распределительную коробку в электротоварах, но мне лень выходить из дома, поэтому, я по-быстрому накидал в солиде уродца и распечатал его на 3D принтере.

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_008.jpg 'Удаленное управление теплом в гараже')

**Крышка:**

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_009.jpg 'Удаленное управление теплом в гараже')

**Процесс печати:**

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_010.jpg 'Удаленное управление теплом в гараже')

**Собрал все в корпус, закрепил модули термоклеем:**

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_011.jpg 'Удаленное управление теплом в гараже')

**Установил крышку, держится и без шурупов, можно было и не предусматривать отверстия под них.**

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_012.jpg 'Удаленное управление теплом в гараже')

Когда моделировал корпус, особо головой не думал, по этому реле почему-то сделал по середине… Лучше было его разместить с краю. Ну да ладно, и так сойдет…

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_013.jpg 'Удаленное управление теплом в гараже')

Притащил все в гараж, подключил, проверил. Вывел двойную розетку т.к. одинарной под руками не было.

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_014.jpg 'Удаленное управление теплом в гараже')

Вывел датчик DHT22 примерно на среднюю высоту стены, т.к. конвекторы сильно греют потолок, а пол помещения долго остается прохладным.

Датчик кстати оснащен и гигрометром, это очень хорошо, т.к. в мастерской я работаю с деревом, знать о текущей влажности воздуха очень полезно.
Провел интернет в гараж. Купил недорогую направленную Wi-Fi антенну, поставил её на карниз пока вот так, летом если дойдут руки и не будет лень сделаю нормальный кронштейн.

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_015.jpg 'Удаленное управление теплом в гараже')

В гараже установил обычную точку доступа и настроил её как адаптер. Поймал сигнал от направленной антенны, которая без труда пробила стену гаража, поставил небольшой коммутатор и подключил к нему нашу систему.

Теперь гараж с домом у нас в одной сети и самое время настроить виртуальный сервер на домашнем роутере.

Прописываем порт который мы открываем например 7777, прописываем IP нашей системы 192.168.1.222, прописываем порт по которому будет доступна наша страница, для доступа из браузера порт 80.

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_016.jpg 'Удаленное управление теплом в гараже')

При наличии статического IP адреса от провайдера, наша система теперь доступна откуда угодно по адресу http://нашip:порт

Если провайдер не предоставляет статический IP, можно сделать и другими способами, но для этого потребуется всегда включенный ПК в доме.

У меня есть статика и зарегистрированный домен, к поддомену которого, я привязал свою систему и мне нет необходимости помнить свой IP для доступа к управлению.

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_017.jpg 'Удаленное управление теплом в гараже')

Не знаю, как на андроиде, а на айфоне можно вывести закладку на экран, она будет доступна как приложение, тем самым мы имеем быстрый доступ к нашей системе без лишних телодвижений и рытья в закладках.

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_018.jpg 'Удаленное управление теплом в гараже')

Далее в планах сделать автоматическую вытяжку при большой влажности или задымленности. Задымленность появляется, когда работаешь фрезером или, когда работает лазерный станок.

# Ссылки

- [Arduino nano](https://ru.aliexpress.com/item/Freeshipping-1PCS-Nano-3-0-controller-compatible-with-arduino-nano-CH340-USB-driver-NO-CABLE/1920431105.html)
- [Модуль ENC28J60](https://ru.aliexpress.com/item/2PCS-ENC28J60-Ethernet-LAN-Network-Module-ENC28J60-For-51-AVR-STM32-ForArduino-LPC-learning-tool-Network/1814498587.html)
- [Датчик температуры DHT22](https://ru.aliexpress.com/item/1pcs-DHT22-digital-temperature-and-humidity-sensor-Temperature-and-humidity-module-AM2302-replace-SHT11-SHT15-Free/1728490400.html)
- [Реле](https://ru.aliexpress.com/item/5PCS-LOY-1-Channel-5V-Relay-Module-for-arduino-1-Channel-realy-KY-019/1741978555.html)
- [3D Принтер](http://3d-diy.ru/shop/148/desc/kit-nabor-prusa-i3steel)
- сайт с тонной готовых 3D моделей: http://www.thingiverse.com/
- [Ethernet shield w5100 регулятор мощности на веб странице](http://tehnopage.ru/ethernet-arduino-pwm-control)
- [Модуль реле 1 реле, операция 5 В. VC-30A 250VAC/30VDC - 181 руб.](https://ru.aliexpress.com/item/1-5-VC-30A-250VAC-30VDC/32678632039.html)

**Спасибо за внимание.**

**Источник**: http://www.yaplakal.com

## Коментарии:
Лучше взять WiFi розетку. Если на даче нет интернета, берется обычный сотовый модем, можно 3g, стоит копейки. Можно тариф без абонентской платы, трафик розетки почти нулевой.

Приложение ставится на телефон. Есть кнопка вкл/выкл и можно программировать таймеры. Например, надо приехать завтра в 9 часов утра, зима. Ставишь программу, чтобы конвектор включился в 6 часов. Приезжаешь - тепло.

Если взять с включенным трафиком, можно и видеокамеру повесить с облачным сервисом.

А можно GSM сигнализацию воткнуть. Стоит она дорого конечно, но там уже есть встроенный модем, датчики народ к ним тоже колхозит, у некоторых моделей много входов-выходов. И не надо точек доступа, антенн, 3Д принтера. Но если человек так в ардуинах шарит, то может это и оправданно было. Да, не многие уверенные пользователи ПК смогут написать такую программу, настроить роутер... Я вот точно не смогу.

---

Забеги на амперку.ру на форуме смотри что я сделал есть такая хрень только телефон к твоей приблуде подвесить ,типа сименс 65 иль модем. И можно работать через смс с любой точки планеты без айпишника и сетки. Там только таймеры стоят еще и реле4 штуки. А вообще неплохо. Я использую сетевуху 1500 ардуино. Там возможнойтей поболе,сайт можно на ардуино закачать.  Забеги на амперку.ру на форуме смотри что я сделал есть такая хрень только телефон к твоей приблуде подвесить ,типа сименс 65 иль модем. И можно работать через смс с любой точки планеты без айпишника и сетки. Там только таймеры стоят еще и реле4 штуки. А вообще неплохо. Я использую сетевуху 1500 ардуино. Там возможнойтей поболе,сайт можно на ардуино закачать.

---
А ещё существуют электрические отопители с встроенным датчиком температуры.

---
Я ещё ленивее подобную систему сделал- купил на али wi-fi камеру (900р) и реле от ик подсветки сделал естественно всё с телефона управляется + видео, а термометр рядом стоит и если нужно глянуть поворачиваешь камеру и смотришь.

---
Делал наподобии с сайта tehnopage.ru.

---
Готовый модуль с управлением через смартфон - https://www.itead.cc/smart-home/sonoff-th.html

---
А я тупо купил GSM розетку +симка и на даче по смс включаю обогреватель за день до приезда. Она и смс пришлет что свет дали (если отключали) и температуру присылает. 2.5т.р. русские делают.

---
> Может попробовать WiFi-модуль ESP?

> Я давно всю систему контроля дачи перевел на эти модули, и ардуинка не нужна, на борту все есть!

> http://www.esp8266.com/


Я думал над этим, но тогда пришлось бы ставить еще одну точку доступа в гараже... ЕСП скорее всего не примет сигнал с направленной антенны, потому как встроенная слабовата, но можно попробовать.

> Я думаю должно получится, у меня ESP видит роутер который в ~20-25 метрах от нее, но правда преград на пути нет, только стена дома и бытовки(сарая)

---
Один вопрос:

Зачем тебе 2 конвектора?

Ведь все это можно реализовать с помощью одного)

По принципу климат-контроля, гараж не нужен +5, собираешься в гараж выставляешь +24 и все)

---
Есть такое реле управления MCS300. Подключается к WiFi, стоит недорого, имеет комфортные приложения для iOS и андроид. Управляется дистанционно хоть из Пномпеня. Настраивается по дням недели и по часам. Имеет два температурных датчика.

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_019.jpg 'Удаленное управление теплом в гараже')

> реле управления MCS300 и Ардуинку сравнивать некорректно, на вскидку стоимость реле в районе 7 000 рублей, а ардуино - от 300 до 500 рублей.

> добавлю: MCS300 за 4800 нашел

---
https://ru.aliexpress.com/item/GSM-Remote-Control-Power-Socket-designed-for-EU-power-supply-also-has-quad-band-frequency-and/32232155195.html

---
Ну, у ТСа просто был принтер, вот он и заморочился печатью. Я корпуса от адсл модемов использую, да и корпус сейчас найти не проблема. Разработка ПО для дуины - куча примеров для работы с датчиками, собираешь их в кучу, пишешь логику управления - там всё просто, на самом дела, этакий конструктор.

Вот, к примеру, терморегулятор подогрева балконного погребка. (фото летнее, так что температуры не пугайтесь)Ну, у ТСа просто был принтер, вот он и заморочился печатью. Я корпуса от адсл модемов использую, да и корпус сейчас найти не проблема. Разработка ПО для дуины - куча примеров для работы с датчиками, собираешь их в кучу, пишешь логику управления - там всё просто, на самом дела, этакий конструктор.

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_020.jpg 'Удаленное управление теплом в гараже')

---
Пишу свою инструкцию по тому как сделать удаленное управление теплом в гараже:
1. Покупаем GSM-розетку за 2500р. (или более, зависит от опций и марки)
2. Покупаем симку любого оператора, управляем включением выключением розетки со своего телефона посредством СМС-сообщений.

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_021.jpg 'Удаленное управление теплом в гараже')

---
Скоее всего, как показал опыт использования тауих реле, в скором времени сломается релюха. При нагрузке в 1500 Вт будут пригорать контакты реле и в итоге оно залипнет в одном из положений (может и в замкнутом). Большую нагрузку, типа нагревателя, лучше подключать через манитный пускатель, который в свою очередь, будет управляться реле.

Upd. Не реклама. Из опыта могу посоветовать. В эксплуатации уже год. Монтируется очень просто. Программируется на компе через USB в интуитивной программке. Работает как часы. Российский производитель. http://ipro-gsm.ru/internet-magazin-2/product/gsm-signalizatsiya-umniy-chasovoy-4-dlya-kotla

> пускатель это уже явный перебор, если на то уж пошло то лучше всего симистор...

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_022.gif 'Удаленное управление теплом в гараже')

или

> Твёрдотельное реле и никаких проблем.

---
Есть розетка такая с таймером, вот я ее в гараже поставил для тосольного подогревателя. Стоит она 500 руб

вариант с с термостатом, за 800 рублей - http://z-plus.ru/category/termoreguljatory-tdm-electric/

---
Регулятор температуры RT-820

Напряжение питания 50-264 В АС/DC, Диапазон от +4 до +30 гр., Контакт 1NO/NC, Максимальный ток 16 А,Сигнализация включения нагрузки.

По достижении заданной температуры контакты исполнительного реле размыкаются и нагреватель отключается. При понижении температуры на величину установленного гистерезиса контакты реле замыкаются, и нагреватель включается снова

Датчик температуры заключён в отрезок термоусаживаемой трубки, поставляется с проводом длиной 2,5 м сечением 0,5 см2 в двойной изоляции

Максимальная мощность электронагревательной установки (ТЭН, радиаторы и т.п.)2000 Вт

1500 руб.

![Удаленное управление теплом в гараже](/images/Village/obogrev_garazha_023.jpg 'Удаленное управление теплом в гараже')
