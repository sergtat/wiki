#  Gentoo. FAQ
##  Установка программ без интернета
На машине, на которой требуется установить пакет, выполняем команду
  emerge -qpf имя-программы | sed '/^$/d;s/ .*$//' | sort -u > links.txt
Таким образом, у нас получается файл links.txt со списком ссылок.  
Копируем links.txt на флешку, несём её на компьютер, где есть интернет, скачиваем файлы:
  wget -c -i links.txt
Или закачиваем файлы в вашем любимом менеджере загрузок.  
Копируем файлы обратно на флешку, идём к первой машине и копируем их в /usr/portage/distfiles/, продолжаем установку программы.
  emerge -av имя-программы

##  Жизнь после установки (Gentoo)
1. Обновить portage.

Этот шаг предстоит делать периодически (но не чаще чем раз в день). При этом обновляется дерево portage (добавляются новые пакеты, новые версии пакетов, удаляются старые).
  # emerge --sync
2. Пересобрать (обновить) system и world.

При этом обновится большинство пакетов, уже установленных в системе (развёрнутых из stage3).  
Для обновления читаем HOWTO Полное обновление системы, либо просто:
  # emerge -epv system
  # emerge -uDNvp world
Сразу же смотрим какие USE-флаги используются пакетами, с помощью ufed в другой консоли включаем нужные, отключаем ненужные.

После обновления пакетов:
  # revdep-rebuild
и потребуется обновить много конфигурационных (и не только) файлов:
  # dispath-conf
Внимание! Всегда обновляем внимательно, смотрим что удаляет и что добавляет, и решаем, нужно нам это или нет.

3. Настройки.
  # reboot

Если при загрузке выводит: "Warning: the current /etc/modules.conf has not been automatically generated" выполняем:
  # update-modules force

Добавление ssh в автозагрузку:
  # rc-update add sshd default

Добавление мыши для консоли в автозагрузку:
  # nano /etc/conf.d/gpm
  #MOUSE=ps2
  MOUSE=imps2

  # rc-update add gpm default

Установка elogv для чтения информации, выводимой пакетами во время установки:
  # echo elogv ~x86 >> /etc/portage/package.keywords
  # emerge elogv

Пакет eix для работы с portage:
  # emerge eix
  # update-eix

Управление частотой процессора, установка "по требованию" (если включали в ядре опции управления частотой):
  # nano /etc/conf.d/local.start
  echo ondemand > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
  echo ondemand > /sys/devices/system/cpu/cpu1/cpufreq/scaling_governor

Установка acpid:
  # emerge sys-power/acpid
  # rc-update add acpid default

Настройка звука (при работающих драйверах в ядре):
  # emerge media-sound/alsa-utils
  # rc-update add alsasound boot
  # alsamixer (снять "mute", настроить громкость)

4. Создание обычного пользователя.

Первое правило: не работать по root'ом. Во-первых, глупая опечатка может порушить систему. Во-вторых, уязвимое ПО, запущенное под root'ом может повлиять на безопасность всей системы (актуально и для Windows ;)). Под root'ом будем работать через sudo и su.

Создаём пользователя:
  # useradd user -m -G users,audio,wheel
Где:
  -m : создать home-директорию
  -G : включить пользователя в перечисленные группы (users, audio, wheel)

Задаём ему пароль:
  # passwd user

В /home появится папка с именем пользователя - его домашний каталог.

Второе правило: каждому пользователю - свой логин.

5. Полезная информация.

Некоторые ключи emerge.
  # emerge <пакет> -ключи
  -f - скачать все файлы, необходимые для установки пакета, но ничего не устанавливать.
  -fp - вывести на экран ссылки на файлы, которые необходимо скачать для установки пакета.
  -pv - просмотр плана установки пакета: какие будут использованы USE-флаги, какие пакеты будут ставиться по зависимостям.
  -pvt - тоже самое, только список пакетов будет отображен в виде дерева, в котором можно увидеть какой пакет от какого зависит.
  -pa - аналог pv, разница в том, что после вывода информации на экран, выдаётся запрос: начать установку - Yes/No?
  -C - удалить пакет из системы.
  -uDNvp - ключи для обновления мира - # emerge -uDNvp world

Про удаление пакетов.
  # emerge -C <пакет>
удаляет пакет, но не удаляет пакеты, установленные по зависимостям к данному пакету. Они останутся в системе бесполезным мусором (если от них не зависит какой-нибудь другой пакет). Проверить систему на бесхозные пакеты можно так:
  # emerge -av --depclean
Проверить, нужен ли каждый пакет, список которых выведет emerge (зависит ли от него кто-нибудь) можно так:
  # equery d <пакет>
Если он нужен, прописать его в world:
  # emerge <пакет> -n

Про USE-флаги.

USE-флаги прописываются либо глобально в /etc/make.conf, либо для каждого пакета индивидуально в /etc/portage/package.use. Где их прописывать - дело ваше. Например, для mc необходима такая комбинация флагов: "-ncurses slang". Прописываем в package.use:
  # echo "app-misc/mc -ncurses slang" >> /etc/portage/package.use
Для редактирования USE-флагов в make.conf используем ufed. Совсем необязательно пытаться сразу включить кучу, как вам может казаться, нужных флагов. Всему своё время: хотите поставить пакет, смотрите какие флаги пакетом могут использоваться, и решаете, что включать, а что нет. При включении какого-либо флага, к установке могут добавляться другие пакеты, тянущиеся по зависимости, и, в свою очередь, имеющие свой набор USE-флагов.

Про автозагрузку.

Сюда мы добавляли при установке: поднятие сети, старт syslog'a, gmp. Это не аналог меню "Автозагрузка" в Windows. Это скорее старт сервисов при загрузке всей системы. В каждой графической среде (Gnome, KDE, xfce, etc...) автозагрузка программ реализуется по-своему.
  # rc-update -s - посмотреть список автозагрузки. rc-status - то же самое, кроме уровня "boot".
  # rc-update add <программа> <уровень_загрузки> - добавление.
  # rc-update del <программа> <уровень_загрузки> - удаление. Если не указан уровень, удаляется из всех, где присутствует.

##  Чистка системы
Хм, ну гента не винда, чтоб за ней следить как за вражеским агентом. И потом, всё этозависит от уровня вашей паранои. В общем, ничего особенного. "Тотальная" чистка у меня отличается от сезонной (три месяца):
- во первых добавлением проверки мусора скриптом findcruft (с gentoo.org);
- во вторых прочесыванием системы согласно хэндбуку File Permissions
Как правило, ничего подозрительного не находится.

Сезонная, базовая чистка включает в себя проверку устаревших зависимостей с помощью как emerge [--deep] --depclean так и с помощью вышеупомянутого скрипта dep, кстати, этот же скрипт может вычищать списки /etc/portage/* и /var/lib/portage/world. Также, в это же время, имеет смысл почистить дистфайлы скриптом eclean (app-portage/gentoolkit)

Проверку на вшивость можно возложить на AIDE и сотоварищей из раздела Intrusion Detection

Также может быть полезна следующая команда:
  find /var/db/pkg/ -type d |sed s/"\/var\/db\/pkg\/"_g | grep \/ | sed s/"-[0-9].*"_g |xargs qcheck
вместо qcheck можно equery check (app-portage/portage-utils и app-portage/gentoolkit соответственно)

##  Ссылки
Handbook: http://www.gentoo.org/doc/ru/handbook/handbook-x86.xml   
Документация Gentoo: http://www.gentoo.org/doc/ru/   
USE flags: http://gentoo-portage.com/USE   

