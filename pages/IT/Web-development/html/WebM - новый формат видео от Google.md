# WebM - новый формат видео от Google
*Автор: Brainsburn*

В последнее время в Интернете все больше пишут о новом формате WebM и видеокодеке VP8. Лично я сперва не очень любил WebM, поскольку он является практически копией формата MKV (Matroska), VP8 основан на Theora, а в качестве аудиокодека в WebM используется Vorbis. Если говорить проще, моя нелюбовь к WebM обосновывалась так: Google просто взяли готовый MKV и сказали, что придумали новый формат для видео. Т.е. по сути они могли бы помочь развитию MKV и Theora, но не сделали этого.

Но я ошибался. По крайней мере, на официальном сайте Matroska по поводу WebM было написано следующее:

> "Сегодня - важный день в истории Matroska. После большой работы разработчиков и сообщества, Matroska был выбран в качестве основы для нового формата - WebM.

> WebM предназначен для web-медиа. Это подмножество Matroska, в котором оставлены только необходимые функции, которые могут быть нужны для Сети. Этот формат уже поддерживается тремя популярнейшими веб-браузерами - Firefox, Chrome и Opera. Наши утилиты mkvalidator и mkclean уже поддерживают формат WebM; в наборе утилит mkvtoolnix поддержка нового формата будет добавлена уже в следующем релизе.

> Вся команда Matroska взволнована и желает новому формату долгую и плодотворную жизнь."  
Источник: http://www.matroska.org/news/webm-matroska.html

Free Software Foundation так же поддерживает WebM и даже переименовала свою кампанию PlayOgg в PlayFreedom.

Теперь немного об истории VP8. Все начиналось с кодека VP3, созданного компанией On2 Technologies. Он развивался, выходили новые версии, которые использовались в Macromedia Flash, Skype и еще много где. VP3 почти 10 лет назад выпустили под лицензией BSD и назвали его Theora. В 2010 году Google купила On2 и открыла исходные коды видеокодека после открытого письма из FSF, в котором Google предлагалось заменить H.264 на VP8, а вместо Flash на веб-ресурсах использовать возможности HTML5.

По поводу Theora я могу сказать следующее. Как ни крути, Theora хуже чем H.264. Я сжимал некоторое количество видео этими кодеками и могу сказать, что отличия были заметны на глаз. Поэтому я очень надеюсь, что Google сможет сделать VP8 таким, чтобы он был по крайней мере не хуже H.264.

Уже сейчас получать видео WebM/VP8/Vorbis можно при помощи ffmpeg. Чтобы в ffmpeg появилась эта возможность, надо сперва собрать и установить libvpx (http://code.google.com/p/webm/downloads/list), а затем собрать ffmpeg с опцией --enable-libvpx. Ну и конечно, в ffmpeg должна быть поддержка Vorbis, т.е. собран он должен быть с опцией --enable-libvorbis. В простейшем случае, команда будет такой:

```
$ ffmpeg -i 1.mkv -f webm -vcodec libvpx -vb 1000k -acodec libvorbis -ab 90k -ac 2 out.webm
```

Однако, лучше использовать как минимум еще две опции: qmin и qmax, которые позволят лучше контролировать битрейт:

```
$ ffmpeg -y -i 1.mkv -f webm -vcodec libvpx -vb 500k -acodec libvorbis -ab 90k -ac 2 -qmin 10 -qmax 42 1.webm
```

Возможен и более продвинутый вариант:

```
$ ffmpeg -y -i 1.mkv -threads 8 -f webm  -vcodec libvpx -deinterlace -g 120 -level 216 -profile 0 -qmax 42 -qmin 10 -rc_buf_aggressivity 0.95 -vb 2M -acodec libvorbis -ab 90k -ac 2 1.webm
```
С этими параметрами надо играть очень осторожно и лучше их вообще не трогать, если не знаете точно, что надо делать.

Основным весомым недостатком VP8 на данный момент является низкая скорость сжатия. Кодек Theora далеко не самый быстрый, но в VP8 видео сжимается раза в 3-4 медленнее, чем в Theora. Я не проводил тестирования, но нескольких минут поисков по сети хватило, чтобы понять, что VP8 работает, наверное, медленней всех остальных аналогичных кодеков. VP8 не идеален и он, к сожалению, хуже H.264 на данный момент. К тому-же, последняя версия libvpx содержит баг, который не позволяет собрать ffmpeg с поддержкой VP8, поэтому мне пришлось устанавливать libvpx из git - она такого бага не имеет. Ну что ж, в Google тоже работают люди, а людям свойственно делать ошибки.

Сравнивать VP8 и H.264 не хочется, потому-что VP8 еще слишком молод, но можно сделать небольшое сравнение VP8 и Theora. Я просто сжал исходное видео высокого качества этими кодеками с дефолтными настройками и одинаковым битрейтом, и теперь можно сравнить два скриншота из этих видео.

Скриншот из видео, сжатого в Theora:

![](/images/Webd/Theora__29-04-2011-13-26-07.png)

Скриншот из видео, сжатого в VP8:

![](/images/Webd/WebM_VP8__29-04-2011-13-27-04.png)

На первый взгляд разницы никакой, но если увеличить скриншоты на 200-300%, то отставание Theora по качеству становится заметным. Особенно, если присмотреться к открытому участку неба - у VP8 этот участок выглядит немного лучше. Таким образом, VP8 уже сейчас пусть немного, но опережает Theora. Весомым недостатком кодека остается низкая скорость сжатия. Поэтому хочется пожелать кодеку VP8 быстрейшего развития и оптимизации кода, и тогда, может быть, он приблизит мир чуточку ближе к открытым стандартам. 
